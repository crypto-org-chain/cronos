syntax = "proto3";
package attestation.v1;

import "amino/amino.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";

option go_package = "github.com/crypto-org-chain/cronos/x/attestation/types";

// Msg defines the attestation Msg service.
service Msg {
  // SubmitBatchBlockAttestation submits multiple block attestations
  rpc SubmitBatchBlockAttestation(MsgSubmitBatchBlockAttestation) returns (MsgSubmitBatchBlockAttestationResponse);

  // SubmitForcedTransaction submits a forced transaction to be executed on target chain
  rpc SubmitForcedTransaction(MsgSubmitForcedTransaction) returns (MsgSubmitForcedTransactionResponse);
}

// MsgSubmitBatchBlockAttestation submits multiple block attestations
message MsgSubmitBatchBlockAttestation {
  option (amino.name) = "attestation/SubmitBatchBlockAttestation";

  // Relayer submitting the attestations
  string relayer = 1;

  // Source chain ID
  string chain_id = 2;

  // List of block attestations
  repeated BlockAttestationData attestations = 3 [(gogoproto.nullable) = false];

  // Relayer signature over the batch attestation data
  bytes signature = 4;
}

// BlockAttestationData contains the data for a single block attestation
// Includes all data needed for full block reconstruction (DA layer)
message BlockAttestationData {
  // Block height (for indexing, also in block_header.Header.Height)
  uint64 block_height = 1;

  // Block hash (for fast lookups, can also compute from block_header)
  bytes block_hash = 3;

  // Block header (encoded) - includes timestamp, app_hash, and all metadata
  bytes block_header = 5;

  // Transaction results (encoded execution results)
  bytes tx_results = 6;

  // FinalizeBlock events (encoded)
  bytes finalize_block_events = 7;

  // Validator updates (encoded)
  bytes validator_updates = 8;

  // Consensus parameter updates (encoded)
  bytes consensus_param_updates = 9;

  // Raw transaction data (REQUIRED FOR RECONSTRUCTION)
  // Encoded Block.Data.Txs - the actual transaction bytes
  bytes transactions = 10;

  // Evidence data (encoded)
  // Encoded Block.Evidence for complete block reconstruction
  bytes evidence = 11;

  // Last commit (encoded)
  // Encoded Block.LastCommit - validator signatures from previous block
  bytes last_commit = 12;
}

// MsgSubmitBatchBlockAttestationResponse is the response for batch submission
message MsgSubmitBatchBlockAttestationResponse {
  // List of attestation IDs
  repeated uint64 attestation_ids = 1;

  // Number of blocks that achieved immediate finality
  uint32 finalized_count = 2;
}

// MsgSubmitForcedTransaction wraps a standard Cosmos transaction for forced execution
message MsgSubmitForcedTransaction {
  option (amino.name) = "attestation/SubmitForcedTransaction";

  // Address submitting the forced transaction
  string submitter = 1;

  // Target chain ID where the transaction should be executed
  string target_chain_id = 2;

  // Target chain type (e.g., "evm", "cosmos")
  string target_chain_type = 3;

  // Priority level (0-255, higher = more urgent)
  uint32 priority = 4;

  // Transaction type
  ForcedTxType tx_type = 5;

  // Serialized transaction data (chain-specific format)
  bytes transaction_data = 6;

  // Deadline block height (0 = no deadline)
  uint64 deadline = 7;

  // Optional metadata
  string metadata = 8;
}

// ForcedTxType defines the type of forced transaction
enum ForcedTxType {
  option (gogoproto.goproto_enum_prefix) = false;

  // Normal forced transaction
  FORCED_TX_TYPE_NORMAL = 0 [(gogoproto.enumvalue_customname) = "ForcedTxTypeNormal"];

  // Governance-related operation
  FORCED_TX_TYPE_GOVERNANCE = 1 [(gogoproto.enumvalue_customname) = "ForcedTxTypeGovernance"];

  // Escape hatch / emergency withdrawal
  FORCED_TX_TYPE_ESCAPE_HATCH = 2 [(gogoproto.enumvalue_customname) = "ForcedTxTypeEscapeHatch"];

  // Emergency system operation
  FORCED_TX_TYPE_EMERGENCY = 3 [(gogoproto.enumvalue_customname) = "ForcedTxTypeEmergency"];
}

// MsgSubmitForcedTransactionResponse is the response for forced transaction submission
message MsgSubmitForcedTransactionResponse {
  // Unique ID for the forced transaction
  uint64 forced_tx_id = 1;

  // Estimated execution block height
  uint64 estimated_execution_height = 2;
}
